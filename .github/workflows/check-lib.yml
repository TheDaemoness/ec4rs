name: Check ec4rs

on:
  pull_request:
    paths:
      - 'src/**.rs'
      - 'Cargo.toml'
      - '.github/workflows/check-lib.yml'
  push:
    branches:
      - main

jobs:
  test:
    name: MSRV Tests (library)
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        build: [linux, windows]
        include:
          - build: linux
            os: ubuntu-latest
          - build: windows
            os: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      - name: Install MSRV Rust
        run: "rustup toolchain install --profile minimal 1.56"
      - name: Build (library)
        run: "cargo build -p ec4rs"
      - name: Unit Tests (library)
        run: "cargo test -p ec4rs"
      - name: Unit Tests (library, all-features)
        run: "cargo test -p ec4rs --all-features"
  quality:
    name: Code Quality (library)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      - name: Install Rust
        run: |
          rustup toolchain install --profile minimal
          rustup component add clippy
          rustup component add rustfmt
      - name: Check Clippy
        run: "cargo clippy -p ec4rs"
      - name: Check Docs
        run: "cargo doc --no-deps -p ec4rs"
      - name: Check Style
        run: "cargo fmt --check -p ec4rs"
